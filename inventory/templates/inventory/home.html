{% extends 'base.html' %}
{% load static %}
{% load inventory_extras %}


{% block title %}Ø§Ù„Ù…Ø®Ø²ÙˆÙ†{% endblock %}

{% block content %}
<h2 class="mb-3">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>

<div class="row mb-4">
    <div class="col-12 d-flex justify-content-between">
        <a href="{% url 'inventory:product_add' %}" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</a>
        <a href="{% url 'inventory:warehouse_add' %}" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙˆØ¯Ø¹ Ø¬Ø¯ÙŠØ¯</a>
    </div>
</div>

<!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<h4>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
<div class="row">
    {% for product in products %}
    <div class="col-md-3 mb-3">
        <div class="card h-100">
            <div class="card-body d-flex flex-column">
                <!-- ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø£Ùˆ Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¥Ù† ÙˆÙØ¬Ø¯Øª -->
                <div class="mb-2 text-center">
                    {% if product.image.url|default_if_none:"" %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" style="max-height:80px; object-fit:contain;">
                    {% else %}
                        <div style="font-size:40px;">ğŸŸ</div>
                    {% endif %}
                </div>
                <h5 class="card-title text-center">{{ product.name }}</h5>
                <p class="card-text text-center mb-1">Ø§Ù„ÙƒÙˆØ¯: {{ product.sku }}</p>
                <p class="card-text text-center mb-2">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: {{ totals|get_item:product.id|default:0 }}</p>

                <div class="mt-auto">
                    <a href="{% url 'inventory:product_detail' product.pk %}" class="btn btn-sm btn-info w-100 mb-1">ØªÙØ§ØµÙŠÙ„</a>
                    <div class="d-flex gap-1">
                        <a href="{% url 'inventory:warehouse_movement_add' 1 %}" class="btn btn-sm btn-primary flex-fill">â• Ø¥Ø¶Ø§ÙØ©</a>
                        <a href="#" class="btn btn-sm btn-danger flex-fill" data-bs-toggle="modal" data-bs-target="#removeModal-{{ product.pk }}">â– Ø³Ø­Ø¨</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ø³Ø­Ø¨ Ù„Ù„Ù…Ù†ØªØ¬ (Ù†Ù…Ø·ÙŠ) -->
    <div class="modal fade" id="removeModal-{{ product.pk }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <form method="post" action="{% url 'inventory:warehouse_stock_remove' 1 %}">
          {% csrf_token %}
          <input type="hidden" name="product" value="{{ product.pk }}">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Ø³Ø­Ø¨ ØµÙ†Ù: {{ product.name }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-2">
                <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</label>
                <select name="warehouse" class="form-select">
                  {% for wh in warehouses %}
                    <option value="{{ wh.pk }}">{{ wh.name }} ({{ wh.code }})</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-2">
                <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                <input type="number" name="quantity" class="form-control" required>
              </div>
              <div class="mb-2">
                <label>Ø§Ù„Ø³Ø¨Ø¨ (Ø¨ÙŠØ¹/ØªÙ„Ù/ØªØ­ÙˆÙŠÙ„)</label>
                <select name="reason" class="form-select">
                  <option value="Ø¨ÙŠØ¹">Ø¨ÙŠØ¹</option>
                  <option value="ØªÙ„Ù">ØªÙ„Ù</option>
                  <option value="ØªØ­ÙˆÙŠÙ„">ØªØ­ÙˆÙŠÙ„</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-danger">Ø³Ø­Ø¨</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
          </div>
        </form>
      </div>
    </div>
    {% endfor %}
</div>

<hr>

<!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª -->
<h4 class="mt-4">Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª</h4>
<div class="row">
    {% for wh in warehouses %}
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{ wh.name }}</h5>
                <p>{{ wh.location }}</p>
                <p class="mb-2">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {{ wh.manager.get_full_name|default:"ØºÙŠØ± Ù…Ø­Ø¯Ø¯" }}</p>
                <div class="d-flex gap-1">
                    <a href="{% url 'inventory:warehouse_detail' wh.pk %}" class="btn btn-sm btn-info flex-fill">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</a>
                    <a href="{% url 'inventory:warehouse_stock_add' wh.pk %}" class="btn btn-sm btn-success flex-fill">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</a>
                    <a href="{% url 'inventory:warehouse_stock_remove' wh.pk %}" class="btn btn-sm btn-danger flex-fill">â– Ø³Ø­Ø¨ ØµÙ†Ù</a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
