{% extends "base.html" %}
{% load static %}
{% block title %}ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™{% endblock %}

{% block content %}
<div class="container mt-4" dir="rtl">
    <h3 class="mb-4 text-center fw-bold text-primary">ÿ¥ÿ¨ÿ±ÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™</h3>

    <div class="card shadow-sm p-3 rounded-4">
        <ul class="account-tree list-unstyled">
            {% for account in accounts %}
                {% if not account.parent %}
                    <li class="account-item mb-2">
                        <div class="account-header d-flex justify-content-between align-items-center bg-light p-2 rounded-3">
                            <div>
                                <button class="toggle-btn btn btn-sm btn-outline-secondary me-2" onclick="toggleChildren(this)">
                                    ‚ûï
                                </button>
                                <span class="fw-bold text-primary">{{ account.code }}</span> - {{ account.name }}
                            </div>
                            <div class="btn-group">
                                <a href="{% url 'account:add_subaccount' account.id %}" class="btn btn-outline-success btn-sm" title="ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ≥ÿßÿ® ŸÅÿ±ÿπŸä">‚ûï</a>
                                <a href="{% url 'account:edit_account' account.id %}" class="btn btn-outline-primary btn-sm" title="ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®">‚úèÔ∏è</a>
                                <a href="{% url 'account:delete_account' account.id %}" class="btn btn-outline-danger btn-sm" onclick="return confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿü')" title="ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ÿ≥ÿßÿ®">üóë</a>
                            </div>
                        </div>

                        {% if account.children.all %}
                            <ul class="account-children list-unstyled ms-4 mt-2 border-end pe-3" style="display: none;">
                                {% include "accounting_app/account_children.html" with parent=account %}
                            </ul>
                        {% endif %}
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
</div>

<style>
.account-tree {
    font-size: 15px;
}
.account-item .account-header {
    transition: all 0.2s ease;
}
.account-item .account-header:hover {
    background-color: #f3f6fa;
}
.toggle-btn {
    width: 28px;
    height: 28px;
    line-height: 18px;
    padding: 0;
    font-size: 16px;
    border-radius: 50%;
}
.account-children {
    border-right: 2px solid #ddd;
    margin-right: 15px;
}
</style>

<script>
function toggleChildren(button) {
    const ul = button.closest("li").querySelector(".account-children");
    if (ul) {
        if (ul.style.display === "none") {
            ul.style.display = "block";
            button.textContent = "‚ûñ";
        } else {
            ul.style.display = "none";
            button.textContent = "‚ûï";
        }
    }
}
</script>
{% endblock %}
