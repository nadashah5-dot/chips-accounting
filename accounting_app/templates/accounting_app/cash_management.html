{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="m-0">إدارة النقدية (Cash Management)</h3>
  </div>

  {% if hint %}
    <div class="alert alert-info">{{ hint }}</div>
  {% endif %}

  <div class="card shadow-sm mb-3">
    <div class="card-header fw-bold">فلترة</div>
    <div class="card-body">
      <form method="get" class="row g-3 align-items-end">

        <div class="col-md-4">
          <label class="form-label">الفترة المحاسبية</label>
          <select name="period" class="form-select">
            <option value="">— كل الفترات —</option>
            {% for p in periods %}
              <option value="{{ p.id }}" {% if selected_period == p.id|stringformat:"s" %}selected{% endif %}>
                {{ p.name }} {% if p.is_closed %}(مقفلة){% endif %}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label">حساب النقدية / البنك</label>
          <select name="account" class="form-select" required>
            <option value="">— اختر حساب الصندوق/البنك —</option>
            {% for a in accounts %}
              <option value="{{ a.id }}" {% if selected_account == a.id|stringformat:"s" %}selected{% endif %}>
                {{ a.code }} - {{ a.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-2">
          <button class="btn btn-primary w-100">عرض</button>
        </div>

      </form>
    </div>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="text-muted">الرصيد الافتتاحي</div>
          <div class="{{ opening_class }}">{{ opening_text }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="text-muted">المقبوضات (Receipts)</div>
          <div class="fw-bold text-success">{{ receipts }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="text-muted">المدفوعات (Payments)</div>
          <div class="fw-bold text-danger">{{ payments }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="text-muted">الرصيد الختامي</div>
          <div class="{{ closing_class }}">{{ closing_text }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header fw-bold">حركة النقدية</div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered text-center align-middle m-0">
        <thead class="table-dark">
          <tr>
            <th style="min-width:120px">التاريخ</th>
            <th style="min-width:140px">رقم القيد</th>
            <th style="min-width:140px">المرجع</th>
            <th style="min-width:260px">البيان</th>
            <th style="min-width:240px">ملاحظة</th>
            <th style="min-width:130px">قبض</th>
            <th style="min-width:130px">دفع</th>
            <th style="min-width:150px">الرصيد</th>
          </tr>
        </thead>

        <tbody>
          {% for r in rows %}
            <tr>
              <td>{{ r.date }}</td>
              <td class="fw-bold">{{ r.entry_serial }}</td>
              <td>{{ r.reference }}</td>
              <td class="text-start">{{ r.description }}</td>
              <td class="text-start">{{ r.note }}</td>

              <td>{% if r.receipt %}{{ r.receipt|floatformat:2 }}{% else %}-{% endif %}</td>
              <td>{% if r.payment %}{{ r.payment|floatformat:2 }}{% else %}-{% endif %}</td>

              <td class="{{ r.balance_class }}">{{ r.balance_text }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="8">لا توجد حركة</td></tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>

</div>
{% endblock %}
