{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="m-0">ميزان المراجعة</h3>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-header fw-bold">فلترة</div>
    <div class="card-body">
      <form method="get" class="row g-3 align-items-end">

        <div class="col-md-6">
          <label class="form-label">الفترة المحاسبية</label>
          <select name="period" class="form-select">
            <option value="">— كل الفترات —</option>
            {% for p in periods %}
              <option value="{{ p.id }}" {% if selected_period == p.id|stringformat:"s" %}selected{% endif %}>
                {{ p.name }} {% if p.is_closed %}(مقفلة){% endif %}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <button class="btn btn-primary w-100">عرض</button>
        </div>

      </form>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header fw-bold">النتائج</div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered text-center align-middle m-0">
        <thead class="table-dark">
          <tr>
            <th rowspan="2">رمز</th>
            <th rowspan="2">اسم الحساب</th>
            <th colspan="2">افتتاحي</th>
            <th colspan="2">حركة</th>
            <th colspan="2">ختامي</th>
          </tr>
          <tr>
            <th>مدين</th>
            <th>دائن</th>
            <th>مدين</th>
            <th>دائن</th>
            <th>مدين</th>
            <th>دائن</th>
          </tr>
        </thead>

        <tbody>
          {% for r in rows %}
          <tr>
            <td class="fw-bold">{{ r.code }}</td>
            <td class="text-start">{{ r.name }}</td>

            <td>{% if r.opening_debit %}{{ r.opening_debit|floatformat:2 }}{% else %}-{% endif %}</td>
            <td>{% if r.opening_credit %}{{ r.opening_credit|floatformat:2 }}{% else %}-{% endif %}</td>

            <td>{% if r.move_debit %}{{ r.move_debit|floatformat:2 }}{% else %}-{% endif %}</td>
            <td>{% if r.move_credit %}{{ r.move_credit|floatformat:2 }}{% else %}-{% endif %}</td>

            <td class="fw-bold">{% if r.closing_debit %}{{ r.closing_debit|floatformat:2 }}{% else %}-{% endif %}</td>
            <td class="fw-bold">{% if r.closing_credit %}{{ r.closing_credit|floatformat:2 }}{% else %}-{% endif %}</td>
          </tr>
          {% empty %}
          <tr><td colspan="8">لا توجد بيانات</td></tr>
          {% endfor %}
        </tbody>

        <tfoot class="table-secondary">
          <tr class="fw-bold">
            <td colspan="2">الإجمالي</td>
            <td>{{ total_opening_debit }}</td>
            <td>{{ total_opening_credit }}</td>
            <td>{{ total_move_debit }}</td>
            <td>{{ total_move_credit }}</td>
            <td>{{ total_closing_debit }}</td>
            <td>{{ total_closing_credit }}</td>
          </tr>
        </tfoot>

      </table>
    </div>
  </div>

</div>
{% endblock %}
